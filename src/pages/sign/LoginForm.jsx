import React, { useState } from 'react';
import KakaoPath from '../../imgs/icon-kakao.png';
import { useDispatch } from 'react-redux';
import useMultipleInput from '../../hooks/useMultipleInput';
import * as SignST from './SingPageStyle';

import { getKakaoCode, loginUser } from '../../shared/api/Users';
import { setRefreshToken } from '../../shared/storage/Cookie';
import { SET_TOKEN } from '../../redux/modules/AuthSlice';
import { SET_USER } from '../../redux/modules/UserSlice';
//import { useNavigate } from 'react-router-dom';

export default function LoginForm({ toggle }) {
  const dispatch = useDispatch();
  //const navigate = useNavigate();
  const [isInvisible, setIsInvisible] = useState(true);
  const [loginInfo, setLoginInfo, loginInfoHandler] = useMultipleInput({
    email: '',
    password: '',
  });

  const onLoginHandler = async () => {
    const response = await loginUser(loginInfo);
    if (response.status) {
      // 로그인 성공
      setRefreshToken(response.headers.refresh_token);
      dispatch(SET_TOKEN(response.headers.authorization));
      dispatch(SET_USER(response.userInfo));
      //navigate(-1);
    } else {
      // 로그인 실패
      console.log(response.headers.error.code, response.headers.error.message);
    }
    console.log(response);
  };

  const onKakaoHandler = async () => {
    await getKakaoCode();
  };

  return (
    <>
      <SignST.SetBox>
        <SignST.InputSet>
          <SignST.InputWrapper>
            <SignST.Input
              placeholder='이메일을 입력해주세요.'
              type='text'
              name='email'
              onChange={loginInfoHandler}
            />
          </SignST.InputWrapper>

          <SignST.InputWrapper>
            <SignST.Input
              placeholder='비밀번호를 입력해주세요.'
              type={isInvisible ? 'password' : 'text'}
              name='password'
              onChange={loginInfoHandler}
            />
            <SignST.InviSVG
              width='24'
              height='24'
              viewBox='0 0 24 24'
              fill='none'
              xmlns='http://www.w3.org/2000/svg'
              onClick={() => {
                setIsInvisible((prev) => !prev);
              }}
            >
              <g mask='url(#mask0_487_1055)'>
                <path
                  d='M16.1 14.3L14.65 12.85C14.8 12.0666 14.575 11.3333 13.975 10.65C13.375 9.96664 12.6 9.69998 11.65 9.84998L10.2 8.39998C10.4833 8.26664 10.7707 8.16664 11.062 8.09998C11.354 8.03331 11.6667 7.99998 12 7.99998C13.25 7.99998 14.3127 8.43731 15.188 9.31198C16.0627 10.1873 16.5 11.25 16.5 12.5C16.5 12.8333 16.4667 13.146 16.4 13.438C16.3333 13.7293 16.2333 14.0166 16.1 14.3ZM19.3 17.45L17.85 16.05C18.4833 15.5666 19.046 15.0373 19.538 14.462C20.0293 13.8873 20.45 13.2333 20.8 12.5C19.9667 10.8166 18.7707 9.47898 17.212 8.48698C15.654 7.49564 13.9167 6.99998 12 6.99998C11.5167 6.99998 11.0417 7.03331 10.575 7.09998C10.1083 7.16664 9.64999 7.26664 9.19999 7.39998L7.64999 5.84998C8.33332 5.56664 9.03332 5.35398 9.74999 5.21198C10.4667 5.07064 11.2167 4.99998 12 4.99998C14.3833 4.99998 16.525 5.62898 18.425 6.88698C20.325 8.14564 21.75 9.78331 22.7 11.8C22.75 11.8833 22.7833 11.9873 22.8 12.112C22.8167 12.2373 22.825 12.3666 22.825 12.5C22.825 12.6333 22.8127 12.7623 22.788 12.887C22.7627 13.0123 22.7333 13.1166 22.7 13.2C22.3167 14.05 21.8377 14.8333 21.263 15.55C20.6877 16.2666 20.0333 16.9 19.3 17.45ZM19.1 22.9L15.6 19.45C15.0167 19.6333 14.4293 19.771 13.838 19.863C13.246 19.9543 12.6333 20 12 20C9.61665 20 7.47499 19.371 5.57499 18.113C3.67499 16.8543 2.24999 15.2166 1.29999 13.2C1.24999 13.1166 1.21665 13.0123 1.19999 12.887C1.18332 12.7623 1.17499 12.6333 1.17499 12.5C1.17499 12.3666 1.18332 12.2416 1.19999 12.125C1.21665 12.0083 1.24999 11.9083 1.29999 11.825C1.64999 11.075 2.06665 10.3833 2.54999 9.74998C3.03332 9.11664 3.56665 8.53331 4.14999 7.99998L2.07499 5.89998C1.89165 5.71664 1.79999 5.48731 1.79999 5.21198C1.79999 4.93731 1.89999 4.69998 2.09999 4.49998C2.28332 4.31664 2.51665 4.22498 2.79999 4.22498C3.08332 4.22498 3.31665 4.31664 3.49999 4.49998L20.5 21.5C20.6833 21.6833 20.7793 21.9126 20.788 22.188C20.796 22.4626 20.7 22.7 20.5 22.9C20.3167 23.0833 20.0833 23.175 19.8 23.175C19.5167 23.175 19.2833 23.0833 19.1 22.9ZM5.54999 9.39998C5.06665 9.83331 4.62499 10.3083 4.22499 10.825C3.82499 11.3416 3.48332 11.9 3.19999 12.5C4.03332 14.1833 5.22899 15.5206 6.78699 16.512C8.34565 17.504 10.0833 18 12 18C12.3333 18 12.6583 17.9793 12.975 17.938C13.2917 17.896 13.6167 17.85 13.95 17.8L13.05 16.85C12.8667 16.9 12.6917 16.9373 12.525 16.962C12.3583 16.9873 12.1833 17 12 17C10.75 17 9.68732 16.5626 8.81199 15.688C7.93732 14.8126 7.49999 13.75 7.49999 12.5C7.49999 12.3166 7.51232 12.1416 7.53699 11.975C7.56232 11.8083 7.59999 11.6333 7.64999 11.45L5.54999 9.39998Z'
                  fill={isInvisible ? '#FF9D73' : 'var(--color-grey'}
                />
              </g>
            </SignST.InviSVG>
          </SignST.InputWrapper>
        </SignST.InputSet>

        <SignST.BtnSet>
          <SignST.LoginBtn onClick={onLoginHandler}>로그인하기</SignST.LoginBtn>
          <SignST.KakaoBtn onClick={onKakaoHandler}>
            <SignST.KakaoLogo src={KakaoPath} alt='kakao logo' />
            카카오로 시작하기
          </SignST.KakaoBtn>
        </SignST.BtnSet>
      </SignST.SetBox>

      <svg
        width='73'
        height='36'
        viewBox='0 0 73 36'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
        onClick={toggle}
      >
        <path
          d='M23.1289 10.8164H21.3926V23.2578H23.1289V10.8164ZM12.7246 19.7441L12.957 21.166C15.1719 21.1729 18.1045 21.1455 20.832 20.6738L20.709 19.3887C19.7109 19.5186 18.665 19.6006 17.6191 19.6484V18.6572C18.9863 18.4043 19.875 17.5566 19.875 16.3945C19.875 15.0068 18.5898 14.0566 16.7441 14.0566C14.9121 14.0566 13.6475 15.0068 13.6543 16.3945C13.6475 17.5635 14.5361 18.4111 15.8965 18.6572V19.71C14.7617 19.7373 13.6748 19.7373 12.7246 19.7441ZM12.9707 13.5645H20.5312V12.1973H17.6328V10.8711H15.8965V12.1973H12.9707V13.5645ZM15.3086 16.3945C15.3018 15.752 15.8965 15.3896 16.7441 15.3828C17.6191 15.3896 18.207 15.752 18.207 16.3945C18.207 17.0508 17.6191 17.4062 16.7441 17.4062C15.8965 17.4062 15.3018 17.0508 15.3086 16.3945ZM35.3105 10.8301H33.5605V18.0488H31.1816V19.2383H33.5605V20.2227H35.3105V10.8301ZM24.7285 16.3398L24.9336 17.7207C25.877 17.7207 26.9365 17.7139 28.0508 17.6729V19.3203H26.3145V23.0391H35.584V21.6445H28.0508V19.9355H29.8008V17.5703C30.8057 17.4951 31.8242 17.3789 32.8086 17.2148L32.7129 15.9707C30.0811 16.292 27.0049 16.3262 24.7285 16.3398ZM25.6445 13.4824C25.6445 14.8154 26.9229 15.6768 28.7754 15.6699C30.5801 15.6768 31.8721 14.8154 31.8789 13.4824C31.8721 12.1562 30.5801 11.2471 28.7754 11.2539C26.9229 11.2471 25.6445 12.1562 25.6445 13.4824ZM27.2988 13.4824C27.292 12.8672 27.8867 12.5254 28.7754 12.5254C29.6094 12.5254 30.2109 12.8672 30.2246 13.4824C30.2109 14.084 29.6094 14.4189 28.7754 14.4121C27.8867 14.4189 27.292 14.084 27.2988 13.4824ZM46.6855 10.8164H44.9355V23.2305H46.6855V17.0234H48.4492V15.5879H46.6855V10.8164ZM36.7324 19.7441L37.7168 21.084C41.9004 19.0264 43.3496 15.8066 43.3633 12.0879H37.4434V13.5098H41.5928C41.2646 16.2852 39.6787 18.2676 36.7324 19.7441ZM59.3867 10.8164H57.6367V17.502H59.3867V10.8164ZM49.1602 14.2891C49.1602 15.9844 50.623 17.2012 52.5645 17.2012C54.499 17.2012 55.9619 15.9844 55.9688 14.2891C55.9619 12.5391 54.499 11.3223 52.5645 11.3359C50.623 11.3223 49.1602 12.5391 49.1602 14.2891ZM50.8691 14.2891C50.8555 13.3525 51.5664 12.7783 52.5645 12.7852C53.5352 12.7783 54.2393 13.3525 54.2461 14.2891C54.2393 15.2119 53.5352 15.7656 52.5645 15.7656C51.5664 15.7656 50.8555 15.2119 50.8691 14.2891ZM51.0605 23.1211H59.3867V18.0488H57.6504V19.2109H52.7832V18.0488H51.0605V23.1211ZM52.7832 21.7129V20.5645H57.6504V21.7129H52.7832Z'
          fill='white'
        />
        <path d='M12 28H61' stroke='white' strokeLinecap='round' />
      </svg>
    </>
  );
}
