import React, { useEffect, useState } from 'react';
import * as SignST from '../SignPageStyle';

export default function StepTwo({
  signInfo,
  handler,
  inCheck,
  setInCheck,
  inCheck2,
  setInCheck2,
  isPwFail2,
  setIsPwFail2,
  pwText2,
  setPwText2,
}) {
  const [isInvisible, setIsInvisible] = useState(true);
  const [isPwFail, setIsPwFail] = useState(true);
  const [pwText, setPwText] = useState(
    '영문, 숫자, 특수문자 포함 4자 이상, 32자 미만'
  );

  const checkProperPassword = async (pw) => {
    const regex =
      /^(?=.*[A-Za-z])(?=.*\d)(?=.*[~!@#$%^&*()+|=])[A-Za-z\d~!@#$%^&*()+|=]{4,32}$/;
    if (pw.match(regex)) return true;
    else return false;
  };

  useEffect(() => {
    setInCheck(true);
    setIsPwFail(true);
    setPwText('영문, 숫자, 특수문자 포함 4자 이상, 32자 미만');
    const handler = setTimeout(async () => {
      const response = await checkProperPassword(signInfo['password']);
      if (response) {
        setInCheck(false);
        setIsPwFail(false);
        setPwText('사용 가능한 비밀번호에요!');
      } else {
        setInCheck(false);
        setIsPwFail(true);
        setPwText('영문, 숫자, 특수문자 포함 4자 이상, 32자 미만');
      }
    }, 500);

    return () => {
      clearTimeout(handler);
    };
    // eslint-disable-next-line
  }, [signInfo['password']]);

  useEffect(() => {
    setInCheck2(true);
    const handler = setTimeout(async () => {
      if (
        signInfo['passwordConfirm'] &&
        signInfo['password'] === signInfo['passwordConfirm']
      ) {
        setInCheck2(false);
        setIsPwFail2(false);
        setPwText2('비밀번호가 일치합니다.');
      } else {
        setInCheck2(false);
        setIsPwFail2(true);
        setPwText2('비밀번호가 일치하지 않습니다.');
      }
    }, 500);

    return () => {
      clearTimeout(handler);
    };
    // eslint-disable-next-line
  }, [signInfo['passwordConfirm']]);

  return (
    <>
      <SignST.InputSet>
        <SignST.InputWrapper>
          <SignST.Input
            placeholder='비밀번호를 입력해주세요.'
            name='password'
            type={isInvisible ? 'password' : 'text'}
            onChange={handler}
          />
          <svg
            width='24'
            height='24'
            viewBox='0 0 24 24'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
            onClick={() => {
              setIsInvisible((prev) => !prev);
            }}
          >
            <g mask='url(#mask0_487_1055)'>
              <path
                d='M16.1 14.3L14.65 12.85C14.8 12.0666 14.575 11.3333 13.975 10.65C13.375 9.96664 12.6 9.69998 11.65 9.84998L10.2 8.39998C10.4833 8.26664 10.7707 8.16664 11.062 8.09998C11.354 8.03331 11.6667 7.99998 12 7.99998C13.25 7.99998 14.3127 8.43731 15.188 9.31198C16.0627 10.1873 16.5 11.25 16.5 12.5C16.5 12.8333 16.4667 13.146 16.4 13.438C16.3333 13.7293 16.2333 14.0166 16.1 14.3ZM19.3 17.45L17.85 16.05C18.4833 15.5666 19.046 15.0373 19.538 14.462C20.0293 13.8873 20.45 13.2333 20.8 12.5C19.9667 10.8166 18.7707 9.47898 17.212 8.48698C15.654 7.49564 13.9167 6.99998 12 6.99998C11.5167 6.99998 11.0417 7.03331 10.575 7.09998C10.1083 7.16664 9.64999 7.26664 9.19999 7.39998L7.64999 5.84998C8.33332 5.56664 9.03332 5.35398 9.74999 5.21198C10.4667 5.07064 11.2167 4.99998 12 4.99998C14.3833 4.99998 16.525 5.62898 18.425 6.88698C20.325 8.14564 21.75 9.78331 22.7 11.8C22.75 11.8833 22.7833 11.9873 22.8 12.112C22.8167 12.2373 22.825 12.3666 22.825 12.5C22.825 12.6333 22.8127 12.7623 22.788 12.887C22.7627 13.0123 22.7333 13.1166 22.7 13.2C22.3167 14.05 21.8377 14.8333 21.263 15.55C20.6877 16.2666 20.0333 16.9 19.3 17.45ZM19.1 22.9L15.6 19.45C15.0167 19.6333 14.4293 19.771 13.838 19.863C13.246 19.9543 12.6333 20 12 20C9.61665 20 7.47499 19.371 5.57499 18.113C3.67499 16.8543 2.24999 15.2166 1.29999 13.2C1.24999 13.1166 1.21665 13.0123 1.19999 12.887C1.18332 12.7623 1.17499 12.6333 1.17499 12.5C1.17499 12.3666 1.18332 12.2416 1.19999 12.125C1.21665 12.0083 1.24999 11.9083 1.29999 11.825C1.64999 11.075 2.06665 10.3833 2.54999 9.74998C3.03332 9.11664 3.56665 8.53331 4.14999 7.99998L2.07499 5.89998C1.89165 5.71664 1.79999 5.48731 1.79999 5.21198C1.79999 4.93731 1.89999 4.69998 2.09999 4.49998C2.28332 4.31664 2.51665 4.22498 2.79999 4.22498C3.08332 4.22498 3.31665 4.31664 3.49999 4.49998L20.5 21.5C20.6833 21.6833 20.7793 21.9126 20.788 22.188C20.796 22.4626 20.7 22.7 20.5 22.9C20.3167 23.0833 20.0833 23.175 19.8 23.175C19.5167 23.175 19.2833 23.0833 19.1 22.9ZM5.54999 9.39998C5.06665 9.83331 4.62499 10.3083 4.22499 10.825C3.82499 11.3416 3.48332 11.9 3.19999 12.5C4.03332 14.1833 5.22899 15.5206 6.78699 16.512C8.34565 17.504 10.0833 18 12 18C12.3333 18 12.6583 17.9793 12.975 17.938C13.2917 17.896 13.6167 17.85 13.95 17.8L13.05 16.85C12.8667 16.9 12.6917 16.9373 12.525 16.962C12.3583 16.9873 12.1833 17 12 17C10.75 17 9.68732 16.5626 8.81199 15.688C7.93732 14.8126 7.49999 13.75 7.49999 12.5C7.49999 12.3166 7.51232 12.1416 7.53699 11.975C7.56232 11.8083 7.59999 11.6333 7.64999 11.45L5.54999 9.39998Z'
                fill={isInvisible ? '#FF9D73' : 'var(--color-grey'}
              />
            </g>
          </svg>

          {
            <SignST.HelpBox>
              {isPwFail ? (
                <svg
                  width='14'
                  height='14'
                  viewBox='0 0 14 14'
                  fill='none'
                  xmlns='http://www.w3.org/2000/svg'
                >
                  <g mask='url(#mask0_616_847)'>
                    <path
                      d='M6.99999 7.58329C7.16527 7.58329 7.30391 7.52729 7.41591 7.41529C7.52752 7.30368 7.58332 7.16524 7.58332 6.99996V4.65204C7.58332 4.48676 7.52752 4.35065 7.41591 4.24371C7.30391 4.13676 7.16527 4.08329 6.99999 4.08329C6.83471 4.08329 6.69627 4.1391 6.58466 4.25071C6.47266 4.36271 6.41666 4.50135 6.41666 4.66663V7.01454C6.41666 7.17982 6.47266 7.31593 6.58466 7.42288C6.69627 7.52982 6.83471 7.58329 6.99999 7.58329ZM6.99999 9.91663C7.16527 9.91663 7.30391 9.86063 7.41591 9.74863C7.52752 9.63701 7.58332 9.49857 7.58332 9.33329C7.58332 9.16801 7.52752 9.02938 7.41591 8.91738C7.30391 8.80576 7.16527 8.74996 6.99999 8.74996C6.83471 8.74996 6.69627 8.80576 6.58466 8.91738C6.47266 9.02938 6.41666 9.16801 6.41666 9.33329C6.41666 9.49857 6.47266 9.63701 6.58466 9.74863C6.69627 9.86063 6.83471 9.91663 6.99999 9.91663ZM6.99999 12.8333C6.19305 12.8333 5.43471 12.6801 4.72499 12.3736C4.01527 12.0676 3.39791 11.652 2.87291 11.127C2.34791 10.602 1.93238 9.98468 1.62632 9.27496C1.31988 8.56524 1.16666 7.8069 1.16666 6.99996C1.16666 6.19301 1.31988 5.43468 1.62632 4.72496C1.93238 4.01524 2.34791 3.39788 2.87291 2.87288C3.39791 2.34788 4.01527 1.93215 4.72499 1.62571C5.43471 1.31965 6.19305 1.16663 6.99999 1.16663C7.80693 1.16663 8.56527 1.31965 9.27499 1.62571C9.98471 1.93215 10.6021 2.34788 11.1271 2.87288C11.6521 3.39788 12.0676 4.01524 12.3737 4.72496C12.6801 5.43468 12.8333 6.19301 12.8333 6.99996C12.8333 7.8069 12.6801 8.56524 12.3737 9.27496C12.0676 9.98468 11.6521 10.602 11.1271 11.127C10.6021 11.652 9.98471 12.0676 9.27499 12.3736C8.56527 12.6801 7.80693 12.8333 6.99999 12.8333Z'
                      fill='var(--color-system-error)'
                    />
                  </g>
                </svg>
              ) : (
                <svg
                  width='14'
                  height='14'
                  viewBox='0 0 14 14'
                  fill='none'
                  xmlns='http://www.w3.org/2000/svg'
                >
                  <g mask='url(#mask0_616_794)'>
                    <path
                      d='M6.18333 8.04996L4.91458 6.78121C4.80764 6.67426 4.67639 6.62079 4.52083 6.62079C4.36528 6.62079 4.22916 6.67913 4.1125 6.79579C4.00555 6.90274 3.95208 7.03885 3.95208 7.20413C3.95208 7.3694 4.00555 7.50551 4.1125 7.61246L5.775 9.27496C5.88194 9.3819 6.01805 9.43538 6.18333 9.43538C6.34861 9.43538 6.48472 9.3819 6.59166 9.27496L9.90208 5.96454C10.009 5.8576 10.0625 5.72635 10.0625 5.57079C10.0625 5.41524 10.0042 5.27913 9.8875 5.16246C9.78055 5.05552 9.64444 5.00204 9.47916 5.00204C9.31389 5.00204 9.17778 5.05552 9.07083 5.16246L6.18333 8.04996ZM7 12.8333C6.19305 12.8333 5.43472 12.6801 4.725 12.3736C4.01528 12.0676 3.39791 11.652 2.87291 11.127C2.34791 10.602 1.93239 9.98468 1.62633 9.27496C1.31989 8.56524 1.16666 7.8069 1.16666 6.99996C1.16666 6.19301 1.31989 5.43468 1.62633 4.72496C1.93239 4.01524 2.34791 3.39788 2.87291 2.87288C3.39791 2.34788 4.01528 1.93215 4.725 1.62571C5.43472 1.31965 6.19305 1.16663 7 1.16663C7.80694 1.16663 8.56527 1.31965 9.275 1.62571C9.98472 1.93215 10.6021 2.34788 11.1271 2.87288C11.6521 3.39788 12.0676 4.01524 12.3737 4.72496C12.6801 5.43468 12.8333 6.19301 12.8333 6.99996C12.8333 7.8069 12.6801 8.56524 12.3737 9.27496C12.0676 9.98468 11.6521 10.602 11.1271 11.127C10.6021 11.652 9.98472 12.0676 9.275 12.3736C8.56527 12.6801 7.80694 12.8333 7 12.8333Z'
                      fill='var(--color-system-success)'
                    />
                  </g>
                </svg>
              )}

              <SignST.HelpText isFail={isPwFail}>{pwText}</SignST.HelpText>
            </SignST.HelpBox>
          }
        </SignST.InputWrapper>
      </SignST.InputSet>

      {isPwFail ? null : (
        <SignST.InputSet style={{ marginTop: '58px' }}>
          <SignST.InputWrapper>
            <SignST.Input
              placeholder='비밀번호를 확인해주세요.'
              name='passwordConfirm'
              type={isInvisible ? 'password' : 'text'}
              onChange={handler}
            />
            <svg
              width='24'
              height='24'
              viewBox='0 0 24 24'
              fill='none'
              xmlns='http://www.w3.org/2000/svg'
              onClick={() => {
                setIsInvisible((prev) => !prev);
              }}
            >
              <g mask='url(#mask0_487_1055)'>
                <path
                  d='M16.1 14.3L14.65 12.85C14.8 12.0666 14.575 11.3333 13.975 10.65C13.375 9.96664 12.6 9.69998 11.65 9.84998L10.2 8.39998C10.4833 8.26664 10.7707 8.16664 11.062 8.09998C11.354 8.03331 11.6667 7.99998 12 7.99998C13.25 7.99998 14.3127 8.43731 15.188 9.31198C16.0627 10.1873 16.5 11.25 16.5 12.5C16.5 12.8333 16.4667 13.146 16.4 13.438C16.3333 13.7293 16.2333 14.0166 16.1 14.3ZM19.3 17.45L17.85 16.05C18.4833 15.5666 19.046 15.0373 19.538 14.462C20.0293 13.8873 20.45 13.2333 20.8 12.5C19.9667 10.8166 18.7707 9.47898 17.212 8.48698C15.654 7.49564 13.9167 6.99998 12 6.99998C11.5167 6.99998 11.0417 7.03331 10.575 7.09998C10.1083 7.16664 9.64999 7.26664 9.19999 7.39998L7.64999 5.84998C8.33332 5.56664 9.03332 5.35398 9.74999 5.21198C10.4667 5.07064 11.2167 4.99998 12 4.99998C14.3833 4.99998 16.525 5.62898 18.425 6.88698C20.325 8.14564 21.75 9.78331 22.7 11.8C22.75 11.8833 22.7833 11.9873 22.8 12.112C22.8167 12.2373 22.825 12.3666 22.825 12.5C22.825 12.6333 22.8127 12.7623 22.788 12.887C22.7627 13.0123 22.7333 13.1166 22.7 13.2C22.3167 14.05 21.8377 14.8333 21.263 15.55C20.6877 16.2666 20.0333 16.9 19.3 17.45ZM19.1 22.9L15.6 19.45C15.0167 19.6333 14.4293 19.771 13.838 19.863C13.246 19.9543 12.6333 20 12 20C9.61665 20 7.47499 19.371 5.57499 18.113C3.67499 16.8543 2.24999 15.2166 1.29999 13.2C1.24999 13.1166 1.21665 13.0123 1.19999 12.887C1.18332 12.7623 1.17499 12.6333 1.17499 12.5C1.17499 12.3666 1.18332 12.2416 1.19999 12.125C1.21665 12.0083 1.24999 11.9083 1.29999 11.825C1.64999 11.075 2.06665 10.3833 2.54999 9.74998C3.03332 9.11664 3.56665 8.53331 4.14999 7.99998L2.07499 5.89998C1.89165 5.71664 1.79999 5.48731 1.79999 5.21198C1.79999 4.93731 1.89999 4.69998 2.09999 4.49998C2.28332 4.31664 2.51665 4.22498 2.79999 4.22498C3.08332 4.22498 3.31665 4.31664 3.49999 4.49998L20.5 21.5C20.6833 21.6833 20.7793 21.9126 20.788 22.188C20.796 22.4626 20.7 22.7 20.5 22.9C20.3167 23.0833 20.0833 23.175 19.8 23.175C19.5167 23.175 19.2833 23.0833 19.1 22.9ZM5.54999 9.39998C5.06665 9.83331 4.62499 10.3083 4.22499 10.825C3.82499 11.3416 3.48332 11.9 3.19999 12.5C4.03332 14.1833 5.22899 15.5206 6.78699 16.512C8.34565 17.504 10.0833 18 12 18C12.3333 18 12.6583 17.9793 12.975 17.938C13.2917 17.896 13.6167 17.85 13.95 17.8L13.05 16.85C12.8667 16.9 12.6917 16.9373 12.525 16.962C12.3583 16.9873 12.1833 17 12 17C10.75 17 9.68732 16.5626 8.81199 15.688C7.93732 14.8126 7.49999 13.75 7.49999 12.5C7.49999 12.3166 7.51232 12.1416 7.53699 11.975C7.56232 11.8083 7.59999 11.6333 7.64999 11.45L5.54999 9.39998Z'
                  fill={isInvisible ? '#FF9D73' : 'var(--color-grey'}
                />
              </g>
            </svg>

            {signInfo['passwordConfirm'] ? (
              <SignST.HelpBox>
                {inCheck2 ? null : isPwFail2 ? (
                  <svg
                    width='14'
                    height='14'
                    viewBox='0 0 14 14'
                    fill='none'
                    xmlns='http://www.w3.org/2000/svg'
                  >
                    <g mask='url(#mask0_616_847)'>
                      <path
                        d='M6.99999 7.58329C7.16527 7.58329 7.30391 7.52729 7.41591 7.41529C7.52752 7.30368 7.58332 7.16524 7.58332 6.99996V4.65204C7.58332 4.48676 7.52752 4.35065 7.41591 4.24371C7.30391 4.13676 7.16527 4.08329 6.99999 4.08329C6.83471 4.08329 6.69627 4.1391 6.58466 4.25071C6.47266 4.36271 6.41666 4.50135 6.41666 4.66663V7.01454C6.41666 7.17982 6.47266 7.31593 6.58466 7.42288C6.69627 7.52982 6.83471 7.58329 6.99999 7.58329ZM6.99999 9.91663C7.16527 9.91663 7.30391 9.86063 7.41591 9.74863C7.52752 9.63701 7.58332 9.49857 7.58332 9.33329C7.58332 9.16801 7.52752 9.02938 7.41591 8.91738C7.30391 8.80576 7.16527 8.74996 6.99999 8.74996C6.83471 8.74996 6.69627 8.80576 6.58466 8.91738C6.47266 9.02938 6.41666 9.16801 6.41666 9.33329C6.41666 9.49857 6.47266 9.63701 6.58466 9.74863C6.69627 9.86063 6.83471 9.91663 6.99999 9.91663ZM6.99999 12.8333C6.19305 12.8333 5.43471 12.6801 4.72499 12.3736C4.01527 12.0676 3.39791 11.652 2.87291 11.127C2.34791 10.602 1.93238 9.98468 1.62632 9.27496C1.31988 8.56524 1.16666 7.8069 1.16666 6.99996C1.16666 6.19301 1.31988 5.43468 1.62632 4.72496C1.93238 4.01524 2.34791 3.39788 2.87291 2.87288C3.39791 2.34788 4.01527 1.93215 4.72499 1.62571C5.43471 1.31965 6.19305 1.16663 6.99999 1.16663C7.80693 1.16663 8.56527 1.31965 9.27499 1.62571C9.98471 1.93215 10.6021 2.34788 11.1271 2.87288C11.6521 3.39788 12.0676 4.01524 12.3737 4.72496C12.6801 5.43468 12.8333 6.19301 12.8333 6.99996C12.8333 7.8069 12.6801 8.56524 12.3737 9.27496C12.0676 9.98468 11.6521 10.602 11.1271 11.127C10.6021 11.652 9.98471 12.0676 9.27499 12.3736C8.56527 12.6801 7.80693 12.8333 6.99999 12.8333Z'
                        fill='var(--color-system-error)'
                      />
                    </g>
                  </svg>
                ) : (
                  <svg
                    width='14'
                    height='14'
                    viewBox='0 0 14 14'
                    fill='none'
                    xmlns='http://www.w3.org/2000/svg'
                  >
                    <g mask='url(#mask0_616_794)'>
                      <path
                        d='M6.18333 8.04996L4.91458 6.78121C4.80764 6.67426 4.67639 6.62079 4.52083 6.62079C4.36528 6.62079 4.22916 6.67913 4.1125 6.79579C4.00555 6.90274 3.95208 7.03885 3.95208 7.20413C3.95208 7.3694 4.00555 7.50551 4.1125 7.61246L5.775 9.27496C5.88194 9.3819 6.01805 9.43538 6.18333 9.43538C6.34861 9.43538 6.48472 9.3819 6.59166 9.27496L9.90208 5.96454C10.009 5.8576 10.0625 5.72635 10.0625 5.57079C10.0625 5.41524 10.0042 5.27913 9.8875 5.16246C9.78055 5.05552 9.64444 5.00204 9.47916 5.00204C9.31389 5.00204 9.17778 5.05552 9.07083 5.16246L6.18333 8.04996ZM7 12.8333C6.19305 12.8333 5.43472 12.6801 4.725 12.3736C4.01528 12.0676 3.39791 11.652 2.87291 11.127C2.34791 10.602 1.93239 9.98468 1.62633 9.27496C1.31989 8.56524 1.16666 7.8069 1.16666 6.99996C1.16666 6.19301 1.31989 5.43468 1.62633 4.72496C1.93239 4.01524 2.34791 3.39788 2.87291 2.87288C3.39791 2.34788 4.01528 1.93215 4.725 1.62571C5.43472 1.31965 6.19305 1.16663 7 1.16663C7.80694 1.16663 8.56527 1.31965 9.275 1.62571C9.98472 1.93215 10.6021 2.34788 11.1271 2.87288C11.6521 3.39788 12.0676 4.01524 12.3737 4.72496C12.6801 5.43468 12.8333 6.19301 12.8333 6.99996C12.8333 7.8069 12.6801 8.56524 12.3737 9.27496C12.0676 9.98468 11.6521 10.602 11.1271 11.127C10.6021 11.652 9.98472 12.0676 9.275 12.3736C8.56527 12.6801 7.80694 12.8333 7 12.8333Z'
                        fill='var(--color-system-success)'
                      />
                    </g>
                  </svg>
                )}

                {inCheck2 ? null : (
                  <SignST.HelpText isFail={isPwFail2}>
                    {pwText2}
                  </SignST.HelpText>
                )}
              </SignST.HelpBox>
            ) : null}
          </SignST.InputWrapper>
        </SignST.InputSet>
      )}

      {isPwFail ? (
        <div
          style={{
            position: 'fixed',
            bottom: '0px',
            width: '100%',
            height: '110px',
            backgroundColor: 'var(--color-white)',
            zIndex: '900',
          }}
        ></div>
      ) : null}
    </>
  );
}
